 # 스마트 가격 알리미 프로젝트 설명
 
 프로젝트 기술 스펙
 spring jpa, spring boot, aws, spring batch, spring security, redis, mongdb, mysql

 스마트 가격알리미는 부가서비스입니다.
 간단하게 기능들을 설명하자면 다음과 같습니다.
 
 ### 스마트폰 시세 메뉴
 내 스마트폰의 중고 시세 최저가 평균가 최고가를 알 수 있고 물론 내 폰이 아니어도 다른 기종도 찾아볼 수 있습니다.  
 공시지원금도 알 수 있습니다.
 
 
 ### 스마트 쇼핑 메뉴
 에누리에서 제공받은 데이터로 전자기기 종류의 매일 갱신되는 최저가 최고가 정보를 알 수 있습니다.  
 만약 내가 원하는 가격을 입력할 경우 매일 가격이 변동되다가 원하는 가격 이하로 떨어진다면  
 앱 푸시로 알려줍니다.  
 매월 택배 포인트 500point를 제공 받을수도 있고  
 물품 구매 후 파손등으로 인한 (재)구매 비용을 최대 100만원 보상해줍니다.


 일단 사용자 관점에서 어떤어떤 기능이 있는지 유스 케이스로 작성해봤습니다.
<p align="center">
  <img src="/images/smart_price_notice/AllUseCase.png" alt="book" width="1200"/>
</p>  



무료회원
 - 스마트폰 시세확인
 - 최저가 관심상품 한개 등록하기
 
유료회원
 - 최저가 관심상품 여러개 등록하기
 - 스마트폰 시세확인
 - 쇼핑혜택
 - 택배 포인트 신청하기

다음은 실제 서비스 되고 있는 페이지들입니다.

<p align="center">
  <img src="/images/smart_price_notice/smart_all.jpg" alt="book" width="250"/>
 <img src="/images/smart_price_notice/smart_gongsi.jpg" alt="book" width="250"/>
 <img src="/images/smart_price_notice/smart_low_list.jpg" alt="book" width="250"/>
 <img src="/images/smart_price_notice/smart_low_price.jpg" alt="book" width="250"/>
 <img src="/images/smart_price_notice/smart_low_price_main.jpg" alt="book" width="250"/>
 <img src="/images/smart_price_notice/smart_my_phone.jpg" alt="book" width="250"/>
</p>  


단순 CRUD페이지를 제외하고 설명하고자 합니다.

첫번째로 설명할 기능은 에누리에게 5기가 xml 파일을 오전 06:00 받아서 (에누리가 당일 가지고 있는 Stuff 전체 데이터)  
약 40분동안 Mongo db에 스프링 배치로 적제하고 그 데이터를 이용해서 스마트 쇼핑 최저가 가격조회 목록들을 보여줍니다.  
<p align="center">
  <img src="/images/smart_price_notice/smart_low_list.jpg" alt="book" width="250"/>
</p>  

Mongo db로 정한 이유는 다음과 같습니다.  
  - 많은 데이터(에누리의 있는 모든 Stuff들이 저장되어야 합니다.)
  - 빠른 응답시간
  - [Eventual Consistency](https://www.scylladb.com/glossary/eventual-consistency/)


적용하다보니 검색에 어려움이 있었습니다.
워낙 데이터가 많다보니 (2000만건 이상) Like 검색으로는 한계가 있었습니다.  
하지만 ELK를 적용하기에는 시간이 부족했고 경험도 부족했습니다.  
그래서 Mongo DB에서 지원하는 [Text Search](https://www.mongodb.com/docs/manual/text-search/) 기술을 사용했습니다.  
속도는 만족할 만큼 나왔지만 키워드에 대한 랭크 지정 등등 나오는 리스트가 에누리 검색 리스트와 너무 동떨어진점이 많았지만  
기술도 인력도 부족해서 그정도로 만족하고 넘어갔습니다.
혹시 에누리쪽에 검색 후 나오는 리스트 Api가 있는지 문의하였으나 그런 Api는 없었습니다.  


두번째로 설명할 기능은 회원 가입, 해지, 로그인 Api 연동입니다.  
초기에 클라이언트쪽에서 요구한 TPS는 100.0/sec 이었습니다.
1000 ms(평균)

엄청난 요구는 아니었지만 일단 Jmeter를 이용해서 부하 테스트를 시행했는데
절반도 못미치는 성능이 나왔고 그 이후에는 Transaction time out이 떴습니다.

원인은 JPA에서 제공하는 ID 생성 전략에 있었습니다.
JPA에서 제공하는 아이디 생성 전략은 4가지가 있습니다.
 - AUTO
 - IDENTITY
 - SEQUENCE
 - TABLE

AUTO 전략은 자동으로 특정한 데이터베이스에 맞게 적당한 전략을 취합니다.
AUTO 전략은 GenerationType의 디폴트 값이고 단순히 @GeneratedValue 어노테이션만 쓴다면 이 전략이 적용됩니다.




 




